<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DRAFT: A Better Way to Think About Data (Part III) | Tales of Industry</title>
<meta name="keywords" content="">
<meta name="description" content="Overcome the SQL malaise using object relational mapping (ORM)">
<meta name="author" content="Jan Scholz">
<link rel="canonical" href="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part3/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f689a0f4dbe4498657f258203900979e0690d357488ff8a6a3b36a38f0c5124f.css" integrity="sha256-9omg9NvkSYZX8lggOQCXngaQ01dIj/imo7NqOPDFEk8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/images/faviconT.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part3/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NMJL1CGE7"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-6NMJL1CGE7');
        }
      </script><meta property="og:title" content="DRAFT: A Better Way to Think About Data (Part III)" />
<meta property="og:description" content="Overcome the SQL malaise using object relational mapping (ORM)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part3/" />
<meta property="og:image" content="http://localhost:1313/images/drafts/default3.jpg" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-08-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-08-01T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/drafts/default3.jpg" />
<meta name="twitter:title" content="DRAFT: A Better Way to Think About Data (Part III)"/>
<meta name="twitter:description" content="Overcome the SQL malaise using object relational mapping (ORM)"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "DRAFT: A Better Way to Think About Data (Part III)",
      "item": "http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part3/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DRAFT: A Better Way to Think About Data (Part III)",
  "name": "DRAFT: A Better Way to Think About Data (Part III)",
  "description": "Overcome the SQL malaise using object relational mapping (ORM)",
  "keywords": [
    
  ],
  "articleBody": "SQL does not fit into the modern software engineering world, the same way that we‚Äôre no longer writing low-level Assembly code.\nThis is a slightly exaggerated statement. And there are no doubt people who will correct me and point out all the scenario‚Äôs where Assembly is still of good use. üòâ\nThe point is that SQL lacks abstraction and is incompatible with the object-oriented paradigm (OOP), which tends to cause a rift between data processing code and application code.\nIn Part I of this series we discussed how SQL is not just a different language, it‚Äôs a different paradigm. SQL‚Äôs declarative syntax requires users to specify the desired outcome, in contrast to the imperative or object-oriented paradigms of C++, Java, or Python.\nObject-oriented programming leverages encapsulation, inheritance, and polymorphism to allow the user to create abstract and expressive code. In Part II we demonstrated how OOP can be used to abstract the SQL approach shown in Part I.\nLuckily, we don‚Äôt have to write this abstraction ourselves. In the final part of this three-part series, we will demonstrate the Object-Relational Mapping (ORM) approach using the popular SQLAlchemy library.\nSQLAlchemy Our poor-man‚Äôs ORM version from Part 2 required us to define a ‚ÄúPerson‚Äù class and its attributes (SSN, FirstName, LastName).\nclass Person(): SSN: int FirstName: str LastName: str Unsurprisingly, we‚Äôll have to do something very similar in SQLAlchemy.\n1 2 3 4 5 6 7 8 9 10 11 from sqlalchemy import Column, Integer, String from sqlalchemy.orm import DeclarativeBase class Base(DeclarativeBase): pass class Person(Base): __tablename__ = 'People' SSN = Column(Integer, primary_key=True) FirstName = Column(String) LastName = Column(String) First we\nhttps://docs.sqlalchemy.org/en/20/orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase\nfrom sqlalchemy import create_engine, Column, Integer, String, select, ForeignKey from sqlalchemy.orm import Session, declarative_base, relationship # Define the database connection string (replace 'sqlite:///example.db' with your database URL) engine = create_engine(\"sqlite+pysqlite:///:memory:\", echo=False) # Define the data model Base = declarative_base() class Person(Base): __tablename__ = 'People' SSN = Column(Integer, primary_key=True) FirstName = Column(String) LastName = Column(String) # Establish one-to-many relationship with Pet pets = relationship(\"Pet\", back_populates=\"owner\") def __repr__(self) -\u003e str: return f\"User(id={self.SSN!r})\" # Define the data model for Pet class Pet(Base): __tablename__ = 'Pets' PetID = Column(Integer, primary_key=True) Species = Column(String) Name = Column(String) OwnerSSN = Column(Integer, ForeignKey('People.SSN')) # Define relationship with Person owner = relationship(\"Person\", back_populates=\"pets\") def __repr__(self) -\u003e str: return f\"Pet(id={self.PetID!r})\" # Create table(s) Base.metadata.create_all(engine) # Insert data into the table data_to_insert = [ {\"SSN\": 123456789, \"FirstName\": \"Raymond\", \"LastName\": \"Johnson\"}, {\"SSN\": 987654321, \"FirstName\": \"Alice\", \"LastName\": \"Smith\"}, {\"SSN\": 456789012, \"FirstName\": \"Raymond\", \"LastName\": \"Williams\"}, {\"SSN\": 789012345, \"FirstName\": \"Bob\", \"LastName\": \"Jones\"}, ] # Insert data into the Pet table pet_data_to_insert = [ {\"PetID\": 1, \"Species\": \"Dog\", \"Name\": \"Buddy\", \"OwnerSSN\": 123456789}, {\"PetID\": 3, \"Species\": \"Bird\", \"Name\": \"Tweetie\", \"OwnerSSN\": 456789012}, {\"PetID\": 4, \"Species\": \"Dog\", \"Name\": \"Max\", \"OwnerSSN\": 789012345}, {\"PetID\": 5, \"Species\": \"Fish\", \"Name\": \"Nemo\", \"OwnerSSN\": 789012345} ] with Session(engine) as session: session.bulk_save_objects([Pet(**d) for d in pet_data_to_insert]) session.commit() with Session(engine) as session: session.bulk_save_objects([Person(**d) for d in data_to_insert]) session.commit() # Query the table for rows where FirstName is \"Raymond\" with Session(engine) as session: query_result = session.execute( select(Person) .where(Person.FirstName == 'Raymond') .where(Person.SSN == Pet.OwnerSSN) ) rows = query_result.fetchall() print(\"Rows where FirstName is 'Raymond':\") for row in rows: # print(row) # print(row._mapping) # print(row._asdict()) # print(row.Person.SSN) print(row.Person.FirstName, row.Person.LastName, \"owns:\", \",\".join([p.Name for p in row.Person.pets])) ",
  "wordCount" : "534",
  "inLanguage": "en",
  "image":"http://localhost:1313/images/drafts/default3.jpg","datePublished": "2024-08-01T00:00:00Z",
  "dateModified": "2024-08-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Jan Scholz"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part3/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tales of Industry",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/images/faviconT.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Tales of Industry (Alt + H)">Tales of Industry</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/post/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      DRAFT: A Better Way to Think About Data (Part III)
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-description">
      Overcome the SQL malaise using object relational mapping (ORM)
    </div>
    <div class="post-meta"><span title='2024-08-01 00:00:00 +0000 UTC'>August 1, 2024</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Jan Scholz

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="http://localhost:1313/images/drafts/default3.jpg" alt="A Picture">
        <p>Caption</p>
</figure>
  <div class="post-content"><p>SQL does not fit into the modern software engineering world, the same way that we&rsquo;re no longer writing low-level Assembly code.</p>
<p>This is a slightly exaggerated statement. And there are no doubt people who will correct me and point out all the scenario&rsquo;s where Assembly is still of good use. üòâ</p>
<p>The point is that SQL lacks abstraction and is incompatible with the object-oriented paradigm (OOP), which tends to cause a rift between data processing code and application code.</p>
<p>In <a href="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part1/">Part I</a> of this series we discussed how SQL is not just a different language, it&rsquo;s a different paradigm. SQL&rsquo;s declarative syntax requires users to specify the desired outcome, in contrast to the imperative or object-oriented paradigms of C++, Java, or Python.</p>
<p>Object-oriented programming leverages encapsulation, inheritance, and polymorphism to allow the user to create abstract and expressive code. In <a href="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part2/">Part II</a> we demonstrated how OOP can be used to abstract the SQL approach shown in Part I.</p>
<p>Luckily, we don&rsquo;t have to write this abstraction ourselves. In the final part of this three-part series, we will demonstrate the Object-Relational Mapping (ORM) approach using the popular <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> library.</p>
<h1 id="sqlalchemy">SQLAlchemy<a hidden class="anchor" aria-hidden="true" href="#sqlalchemy">#</a></h1>
<p>Our poor-man&rsquo;s ORM version from Part 2 required us to define a &ldquo;Person&rdquo; class and its attributes (SSN, FirstName, LastName).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">SSN</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">FirstName</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">LastName</span><span class="p">:</span> <span class="nb">str</span>
</span></span></code></pre></div><p>Unsurprisingly, we&rsquo;ll have to do something very similar in SQLAlchemy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">DeclarativeBase</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;People&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SSN</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">FirstName</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">LastName</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>First we</p>
<p><a href="https://docs.sqlalchemy.org/en/20/orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase">https://docs.sqlalchemy.org/en/20/orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">ForeignKey</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">declarative_base</span><span class="p">,</span> <span class="n">relationship</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the database connection string (replace &#39;sqlite:///example.db&#39; with your database URL)</span>
</span></span><span class="line"><span class="cl"><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&#34;sqlite+pysqlite:///:memory:&#34;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the data model</span>
</span></span><span class="line"><span class="cl"><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;People&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SSN</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">FirstName</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">LastName</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Establish one-to-many relationship with Pet</span>
</span></span><span class="line"><span class="cl">    <span class="n">pets</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&#34;Pet&#34;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&#34;owner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;User(id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SSN</span><span class="si">!r}</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the data model for Pet</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pet</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;Pets&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">PetID</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Species</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">OwnerSSN</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;People.SSN&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Define relationship with Person</span>
</span></span><span class="line"><span class="cl">    <span class="n">owner</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&#34;Person&#34;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&#34;pets&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Pet(id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">PetID</span><span class="si">!r}</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create table(s)</span>
</span></span><span class="line"><span class="cl"><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Insert data into the table</span>
</span></span><span class="line"><span class="cl"><span class="n">data_to_insert</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;SSN&#34;</span><span class="p">:</span> <span class="mi">123456789</span><span class="p">,</span> <span class="s2">&#34;FirstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Raymond&#34;</span><span class="p">,</span> <span class="s2">&#34;LastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Johnson&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;SSN&#34;</span><span class="p">:</span> <span class="mi">987654321</span><span class="p">,</span> <span class="s2">&#34;FirstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Alice&#34;</span><span class="p">,</span>   <span class="s2">&#34;LastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Smith&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;SSN&#34;</span><span class="p">:</span> <span class="mi">456789012</span><span class="p">,</span> <span class="s2">&#34;FirstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Raymond&#34;</span><span class="p">,</span> <span class="s2">&#34;LastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Williams&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;SSN&#34;</span><span class="p">:</span> <span class="mi">789012345</span><span class="p">,</span> <span class="s2">&#34;FirstName&#34;</span><span class="p">:</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span>     <span class="s2">&#34;LastName&#34;</span><span class="p">:</span> <span class="s2">&#34;Jones&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Insert data into the Pet table</span>
</span></span><span class="line"><span class="cl"><span class="n">pet_data_to_insert</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;PetID&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Species&#34;</span><span class="p">:</span> <span class="s2">&#34;Dog&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Buddy&#34;</span><span class="p">,</span> <span class="s2">&#34;OwnerSSN&#34;</span><span class="p">:</span> <span class="mi">123456789</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;PetID&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Species&#34;</span><span class="p">:</span> <span class="s2">&#34;Bird&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Tweetie&#34;</span><span class="p">,</span> <span class="s2">&#34;OwnerSSN&#34;</span><span class="p">:</span> <span class="mi">456789012</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;PetID&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;Species&#34;</span><span class="p">:</span> <span class="s2">&#34;Dog&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Max&#34;</span><span class="p">,</span> <span class="s2">&#34;OwnerSSN&#34;</span><span class="p">:</span> <span class="mi">789012345</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;PetID&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;Species&#34;</span><span class="p">:</span> <span class="s2">&#34;Fish&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Nemo&#34;</span><span class="p">,</span> <span class="s2">&#34;OwnerSSN&#34;</span><span class="p">:</span> <span class="mi">789012345</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">bulk_save_objects</span><span class="p">([</span><span class="n">Pet</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pet_data_to_insert</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">bulk_save_objects</span><span class="p">([</span><span class="n">Person</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_to_insert</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Query the table for rows where FirstName is &#34;Raymond&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">query_result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">select</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">FirstName</span> <span class="o">==</span> <span class="s1">&#39;Raymond&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">SSN</span> <span class="o">==</span> <span class="n">Pet</span><span class="o">.</span><span class="n">OwnerSSN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rows</span> <span class="o">=</span> <span class="n">query_result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Rows where FirstName is &#39;Raymond&#39;:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(row)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(row._mapping)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(row._asdict())</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(row.Person.SSN)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">LastName</span><span class="p">,</span> <span class="s2">&#34;owns:&#34;</span><span class="p">,</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">Name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">pets</span><span class="p">]))</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/post/2024-03-06-a-better-way-to-think-about-data-part2/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>DRAFT: A Better Way to Think About Data (Part II)</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Tales of Industry</a></span>
    <span>by Jan Scholz.</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
